<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FFmpeg 水印管理台</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="card">
        <div class="header">
          <h1>FFmpeg 水印批处理平台</h1>
          <p>
            轻后端架构，利用本地 FFmpeg 队列批量处理多格式视频，为文字 / PNG 透明图片添加水印，并支持高级性能调优。
          </p>
        </div>

        <div class="tabs">
          <button class="tab-button active" data-tab="jobs">任务队列</button>
          <button class="tab-button" data-tab="settings">高级设置</button>
          <button class="tab-button" data-tab="monitor">调试监控</button>
        </div>

        <section id="tab-jobs" class="tab-content">
          <form id="job-form" class="grid grid-two" enctype="multipart/form-data">
            <fieldset>
              <div class="section-title">上传与输出</div>
              <label>
                视频文件（可多选）
                <input type="file" name="files" id="files" accept="video/*" multiple required />
              </label>
              <label>
                导出格式
                <select name="output_format" id="output-format">
                  <option value="mp4">MP4 (默认)</option>
                  <option value="mov">MOV</option>
                  <option value="mkv">MKV</option>
                  <option value="gif">GIF</option>
                  <option value="webm">WebM</option>
                </select>
              </label>
              <label>
                预设
                <select name="preset" id="preset">
                  <option value="medium">medium</option>
                  <option value="slow">slow</option>
                  <option value="fast">fast</option>
                  <option value="veryfast">veryfast</option>
                </select>
              </label>
            </fieldset>

            <fieldset>
              <div class="section-title">水印设置</div>
              <label>类型</label>
              <div class="toggle-group" id="watermark-type">
                <button type="button" data-value="text" class="active">文字</button>
                <button type="button" data-value="image">PNG 图片</button>
              </div>
              <div id="text-watermark-fields">
                <label>
                  水印文字
                  <textarea name="watermark_text" rows="3" placeholder="输入需要叠加的文字"></textarea>
                </label>
                <label>
                  字号
                  <input type="number" name="font_size" value="48" min="12" max="256" />
                </label>
                <label>
                  颜色
                  <input type="text" name="color" value="white" placeholder="#FFFFFF 或者 white" />
                </label>
              </div>
              <div id="image-watermark-fields" style="display: none">
                <label>
                  PNG 水印
                  <input type="file" name="watermark_image" accept="image/png" />
                </label>
              </div>
              <div class="grid grid-two">
                <label>
                  不透明度
                  <input type="number" step="0.1" min="0" max="1" name="opacity" value="0.85" />
                </label>
                <label>
                  位置
                  <select name="position">
                    <option value="top-left">左上</option>
                    <option value="top-right" selected>右上</option>
                    <option value="bottom-left">左下</option>
                    <option value="bottom-right">右下</option>
                    <option value="center">居中</option>
                  </select>
                </label>
              </div>
              <div class="grid grid-two">
                <label>
                  X 偏移
                  <input type="number" name="offset_x" value="32" />
                </label>
                <label>
                  Y 偏移
                  <input type="number" name="offset_y" value="32" />
                </label>
              </div>
            </fieldset>

            <fieldset style="grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center;">
              <div>
                <span class="badge pending">CPU 队列</span>
                <small style="display: block; margin-top: 0.25rem; color: rgba(148, 163, 184, 0.7)">
                  当前采用 10 核心 20 线程预设，可根据需要在高级设置中调整并行度。
                </small>
              </div>
              <button type="submit" class="primary">提交任务</button>
            </fieldset>
          </form>

          <div style="margin-top: 2rem">
            <div class="section-title">任务状态</div>
            <table class="jobs-table" id="jobs-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>状态</th>
                  <th>进度</th>
                  <th>开始时间</th>
                  <th>结束时间</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div style="margin-top: 2rem">
            <div class="section-title">任务日志</div>
            <div id="log-viewer" class="log-viewer">选择一个任务查看运行日志。</div>
          </div>
        </section>

        <section id="tab-settings" class="tab-content" style="display: none">
          <div class="grid grid-two">
            <div>
              <div class="section-title">计算资源</div>
              <label>并行任务数</label>
              <input type="range" class="range-input" id="parallel-range" min="1" max="10" value="2" />
              <div id="parallel-value">当前并行：2</div>
              <div style="margin-top: 1.5rem">
                <label>目标设备</label>
                <div class="toggle-group" id="device-toggle">
                  <button type="button" data-value="cpu" class="active">CPU</button>
                  <button type="button" data-value="intel" disabled title="待开启">核显 (QSV)</button>
                  <button type="button" data-value="nvidia" disabled title="待开启">NVIDIA</button>
                </div>
                <small style="display: block; margin-top: 0.5rem; color: rgba(148, 163, 184, 0.6)">
                  GPU 支持预留接口，待后续启用。当前默认使用 CPU 并行加速。
                </small>
              </div>
            </div>
            <div>
              <div class="section-title">FFmpeg 二进制路径</div>
              <label>
                <input type="text" id="ffmpeg-binary" placeholder="例如 /usr/bin/ffmpeg" />
              </label>
              <div class="section-title" style="margin-top: 2rem">默认导出格式</div>
              <label>
                <select id="default-output">
                  <option value="mp4">MP4</option>
                  <option value="mov">MOV</option>
                  <option value="mkv">MKV</option>
                  <option value="webm">WebM</option>
                </select>
              </label>
              <div style="margin-top: 2rem; display: flex; gap: 1rem">
                <button class="primary" id="save-settings">保存设置</button>
                <button class="secondary" id="refresh-settings">刷新</button>
              </div>
            </div>
          </div>
        </section>

        <section id="tab-monitor" class="tab-content" style="display: none">
          <div class="section-title">实时性能监控</div>
          <div class="chart-placeholder">
            图表接口已预留，可接入 Prometheus / WebSocket 实时数据。当前展示示意图。
          </div>
          <div class="grid" style="margin-top: 2rem">
            <div class="card" style="padding: 1.5rem">
              <div class="section-title">队列概览</div>
              <ul id="queue-stats">
                <li>总任务数：<span data-field="total">0</span></li>
                <li>进行中：<span data-field="running">0</span></li>
                <li>已完成：<span data-field="completed">0</span></li>
                <li>失败：<span data-field="failed">0</span></li>
              </ul>
            </div>
          </div>
        </section>

        <footer>© 2024 FFmpeg Shuiyin. 轻量级后端 + Web 管理台示例。</footer>
      </div>
    </div>

    <script type="module" src="assets/app.js"></script>
  </body>
</html>
